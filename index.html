<body style="background: white"></body>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://unpkg.com/tone"></script>
<script>
/* global nn, Tone */

 
function randomSteps () {
  let steps = []
  let tot = 0
  while (tot < 12) {
    let indiv = (Math.random() < 0.4 || tot > 10) ? 1 : 2
    // adding steps as long as we haven't hit the limit
    if (tot + indiv <= 12)
      steps.push(indiv)
      tot += indiv
  }
  
  while (steps.length !== 7) {
    if (steps.length < 7)
      steps.push(1)
    else
      steps.pop()
  }
  return steps
}

function playNote (root, mode) {
  
  
  const scale = [root]
  let note = root.slice(0, -1)
  let octave = parseInt(root.slice(-1))
  const notes = [
    'A', 'B', 'C', 'D'
  ]
  for (const step of mode) {
    const currNoteIdx = notes.indexOf(note)
    const nextNoteIdx = (currNoteIdx + step) % notes.length
    if (nextNoteIdx < currNoteIdx) octave += 1
    note = notes[nextNoteIdx]
    scale.push(note + octave)
  }
  const synth = new Tone. Synth.toDestination()
  const playNote = scale[Math.floor(Math.random() * scale.length)]
  synth.triggerAttackRelease(playNote, "8n")
  return scale
  
}
let mode = randomSteps()

function randomPlace () {
  for (let i=0; i < 7; i++) {
    let circleButton = nn.create('div')
      .style('font-size', '40px')
      .text('ðŸ”µ')
      .on('click', () => playNote('A4', mode))
    const x = Math.random() * nn.width()
    const y = Math.random() * nn.height()
    circleButton.move(x,y)
    
  }
}
nn.on('load', () => {randomPlace()})

</script>
